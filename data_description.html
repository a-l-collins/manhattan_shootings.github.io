<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Data Processing</title>

<script src="site_libs/header-attrs-2.29/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/journal.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="data_description.html">Data</a>
</li>
<li>
  <a href="full_report.html">Summary Report</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="alissa_location.html">Location-based Patterns</a>
</li>
<li>
  <a href="Miho_Murder-flag.html">Fatal Shooting Outcomes</a>
</li>
<li>
  <a href="Kino_Green_Space.html">Predictor 1: Green Space</a>
</li>
<li>
  <a href="Streetlamp_tehsuan.html">Predictor 2: Unlit Street Lamps</a>
</li>
<li>
  <a href="Ainsel_Weather.html">Time Analysis</a>
</li>
<li>
  <a href="https://github.com/a-l-collins/manhattan_shootings.github.io.git">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Data Processing</h1>

</div>


<div id="libraries" class="section level3">
<h3><strong>Libraries</strong></h3>
<pre class="r"><code>library(tidyverse)
library(rvest)
library(httr)
library(tidycensus)
library(sf)
library(tigris)
library(mapview)

# add any other libraries used</code></pre>
</div>
<div id="shooting-data" class="section level3">
<h3><strong>Shooting Data</strong></h3>
<div id="the-data" class="section level4">
<h4><em>The Data</em></h4>
<p>Shooting data was downloaded from NYC Open Data, with two separate
datasets for <a
href="https://data.cityofnewyork.us/Public-Safety/NYPD-Shooting-Incident-Data-Year-To-Date-/5ucz-vwe8/about_data">2025
data</a> and for <a
href="https://data.cityofnewyork.us/Public-Safety/NYPD-Shooting-Incident-Data-Historic-/833y-fsy8/about_data">historical
(2026-2024) data</a>. When combined, the two datasets have a total of
3,103 independent observations across 24 variables. These variables
include information such as the age/gender/race of the perpetrator, the
age/gender/race of the victim, the day on which the shooting took place,
the time at which it took place, its general location (whether or not it
was indoors, whether or not it took place within an apartment), and
whether or not it was a fatal shooting.</p>
</div>
<div id="cleaning-the-data" class="section level4">
<h4><em>Cleaning the Data</em></h4>
<p>The shooting data was available in a historical (2006-2024) format,
and a 2025 format. We changed the <code>statistical_murder_flag</code>
designations in the 2025 variant of the data to match the historical
data before binding the two datasets together. We also made sure to only
include Manhattan incidents, and ensured that each incident key within
<code>incident_key</code> only occurred once, to remove repeat inputs
(to account for multiple victims or perpetrators) and prevent them from
skewing the data. Both data sets of shooting incidents were filtered to
exclude missing latitude/longitude, which are key variables in the
predictors data sets. After mapping, <code>incident_key</code> =
279138121 and 272105041 from <code>shooting06_24_df</code> were excluded
because their latitudes/longitudes don’t match with the Manhattan
borough.</p>
<pre class="r"><code># THIS IS BASED ON AINSEL&#39;S PROCESS. Look it over and see if your process agrees; if it doesn&#39;t, text or something so we can work it out
shooting_h &lt;- read_csv(&quot;./Data Folder/Shooting_Historic.csv&quot;) %&gt;% 
  janitor::clean_names()

shooting_2025 &lt;- read_csv(&quot;./Data Folder/Shooting_2025.csv&quot;) %&gt;% 
  janitor::clean_names() %&gt;% 
  mutate(statistical_murder_flag = case_match(statistical_murder_flag,
                                             &quot;N&quot; ~ FALSE,
                                             &quot;Y&quot; ~ TRUE))

shooting &lt;- bind_rows(shooting_2025, shooting_h) %&gt;% 
  separate_wider_delim(occur_date, delim = &quot;/&quot;, names_sep = &quot;.&quot;) %&gt;% 
  rename(
    month = occur_date.1,
    day = occur_date.2,
    year = occur_date.3,
    time = occur_time
  ) %&gt;% 
  mutate(
    month = case_match(month,
      &quot;01&quot; ~ &quot;January&quot;,
      &quot;02&quot; ~ &quot;February&quot;,
      &quot;03&quot; ~ &quot;March&quot;,
      &quot;04&quot; ~ &quot;April&quot;,
      &quot;05&quot; ~ &quot;May&quot;,
      &quot;06&quot; ~ &quot;June&quot;,
      &quot;07&quot; ~ &quot;July&quot;,
      &quot;08&quot; ~ &quot;August&quot;,
      &quot;09&quot; ~ &quot;September&quot;,
      &quot;10&quot; ~ &quot;October&quot;,
      &quot;11&quot; ~ &quot;November&quot;,
      &quot;12&quot; ~ &quot;December&quot;),
    day = as.numeric(day),
    year = as.numeric(year)) %&gt;% 
  distinct(incident_key, .keep_all = TRUE) %&gt;% 
  filter(boro == &quot;MANHATTAN&quot;,
         !incident_key %in% c(279138121, 272105041)) |&gt; 
  drop_na(latitude)</code></pre>
</div>
</div>
<div id="time-data" class="section level3">
<h3><strong>Time Data</strong></h3>
<div id="daylight-data" class="section level4">
<h4><em>Daylight Data</em></h4>
<p>Data on when sunrise and sunset occurs for each day of the year was
pulled from <a
href="https://newyorkcityphotosafari.com/blog/sunrise-sunset-times-in-nyc.html">New
York City Photo Safari</a>. It was scraped from the website a single
time before being saved in a table, and that table was used for
subsequent analysis. This data was then cleaned, merged with the
shooting data created above, the sunrise/sunset/time variables cleaned
so they both match and are in a 24-hour format, and a
<code>daylight</code> variable was created to indicate whether each
individual shooting occurred within its date’s provided sunrise/sunset
times or not.</p>
<pre class="r"><code># Ran once to pull table from website:
url = &quot;https://newyorkcityphotosafari.com/blog/sunrise-sunset-times-in-nyc.html&quot;

daylight &lt;- read_html(url) |&gt;  
  html_table() %&gt;% 
  as.data.frame() %&gt;% 
  janitor::clean_names()

# write.table(daylight, file = &quot;./Data Folder/Daylight_Hours.txt&quot;, quote = F, row.names = F, col.names = T, sep = &quot;\t&quot;)

daylight &lt;- read.table(&quot;./Data Folder/Daylight_Hours.txt&quot;, header = T, sep = &#39;\t&#39;) %&gt;% 
  rename(day = var_1) %&gt;% 
  pivot_longer(
    jan:dec,
    names_to = &quot;month&quot;,
    values_to = &quot;time&quot;
  ) %&gt;% 
  separate_wider_delim(time, delim = &quot;/&quot;, names_sep = &quot;_&quot;) %&gt;% 
  rename(
    sunrise = time_1,
    sunset = time_2
  ) %&gt;% 
  mutate(
    month = case_match(month,
      &quot;jan&quot; ~ &quot;January&quot;,
      &quot;feb&quot; ~ &quot;February&quot;,
      &quot;mar&quot; ~ &quot;March&quot;,
      &quot;apr&quot; ~ &quot;April&quot;,
      &quot;may&quot; ~ &quot;May&quot;,
      &quot;jun&quot; ~ &quot;June&quot;,
      &quot;jul&quot; ~ &quot;July&quot;,
      &quot;aug&quot; ~ &quot;August&quot;,
      &quot;sep&quot; ~ &quot;September&quot;,
      &quot;oct&quot; ~ &quot;October&quot;,
      &quot;nov&quot; ~ &quot;November&quot;,
      &quot;dec&quot; ~ &quot;December&quot;)
    )

# Creates a variable for day/night
daylight_shooting &lt;- left_join(shooting, daylight, by = c(&quot;month&quot;, &quot;day&quot;)) %&gt;%
  separate_wider_delim(time, delim = &quot;:&quot;, names_sep = &quot;_&quot;) %&gt;% 
  separate_wider_delim(sunrise:sunset, delim = &quot;:&quot;, names_sep = &quot;_&quot;) %&gt;% 
  rename(
    hour = time_1,
    minute = time_2,
    sunrise_hour = sunrise_1,
    sunrise_minute = sunrise_2,
    sunset_hour = sunset_1,
    sunset_minute = sunset_2
  ) %&gt;% 
  select(-time_3) %&gt;% 
  mutate(
    hour = as.numeric(hour),
    minute = as.numeric(minute),
    
    sunrise_minute = as.numeric(sunrise_minute),
    sunrise_hour = as.numeric(sunrise_hour),
    
    sunset_minute = na_if(sunset_minute, &quot;&quot;),
    sunset_minute = as.numeric(sunset_minute),
    sunset_minute = replace_na(sunset_minute, 0),
    sunset_hour = as.numeric(sunset_hour),
    sunset_hour = sunset_hour + 12,
    
    daylight = case_when(
      hour &gt; sunrise_hour &amp; hour &lt; sunset_hour ~ TRUE,
      hour == sunrise_hour &amp; minute &gt;= sunrise_minute ~ TRUE,
      hour == sunset_hour &amp; minute &lt;= sunset_minute ~ TRUE
    ),
    daylight = case_match(daylight,
      TRUE ~ &quot;Daytime&quot;,
      NA ~ &quot;Nighttime&quot;
    )
  ) %&gt;% 
  select(incident_key, month, day, year, hour, minute, sunrise_hour, sunrise_minute, sunset_hour, sunset_minute, daylight, everything())

readr::write_csv(
  daylight_shooting, 
  file = &quot;./Data Folder/Daylight_Shooting_Stratified.csv&quot;
)</code></pre>
</div>
<div id="day-of-the-week-data" class="section level4">
<h4><em>Day of the Week Data</em></h4>
<p>Calendars for 2006-2025 were downloaded and added to a single excel
workbook from <a href="https://www.generalblue.com/calendar">General
Blue</a>.</p>
<p>The following functions were created in order to read all calendars
into a single dataframe:</p>
<pre class="r"><code>#&#39; Read in calendar
#&#39;
#&#39; @param year Relevant sheet name
#&#39; @param range Range for the relevant month
#&#39;
#&#39; @returns Formatted month dates for the provided year and month
read_calendar = function(year, month, range) {
  sheet_name = as.character(year)
  range = as.character(range)
  month = as.character(month)
  
  func_cal &lt;- readxl::read_xlsx(&quot;./Data Folder/Calendar_AllYears.xlsx&quot;, range = range, sheet = sheet_name) %&gt;% 
    janitor::clean_names() %&gt;% 
    rename(
      Sunday = s_1,
      Monday = m,
      Tuesday = t_3,
      Wednesday = w,
      Thursday = t_5,
      Friday = f,
      Saturday = s_7
    ) %&gt;% 
    pivot_longer(
      Sunday:Saturday,
      names_to = &quot;day_of_week&quot;,
      values_to = &quot;day&quot;
    ) %&gt;% 
    drop_na(day) %&gt;% 
    mutate(
      month = month,
      year = year
    )
  
  func_cal
}

#&#39; Create a yearly calendar
#&#39;
#&#39; @param year Relevant sheet name
#&#39;
#&#39; @returns Full calendar for the provided year
create_yearly_calendar = function(year) {
  year = as.character(year)
  
  func_cal &lt;- bind_rows(
    read_calendar(year = year, month = &quot;January&quot;, range = &quot;A3:G9&quot;),
    read_calendar(year = year, month = &quot;February&quot;, range = &quot;I3:O9&quot;),
    read_calendar(year = year, month = &quot;March&quot;, range = &quot;Q3:W9&quot;),
    read_calendar(year = year, month = &quot;April&quot;, range = &quot;A12:G18&quot;),
    read_calendar(year = year, month = &quot;May&quot;, range = &quot;I12:O18&quot;),
    read_calendar(year = year, month = &quot;June&quot;, range = &quot;Q12:W18&quot;),
    read_calendar(year = year, month = &quot;July&quot;, range = &quot;A21:G27&quot;),
    read_calendar(year = year, month = &quot;August&quot;, range = &quot;I21:O27&quot;),
    read_calendar(year = year, month = &quot;September&quot;, range = &quot;Q21:W27&quot;),
    read_calendar(year = year, month = &quot;October&quot;, range = &quot;A30:G36&quot;),
    read_calendar(year = year, month = &quot;November&quot;, range = &quot;I30:O36&quot;),
    read_calendar(year = year, month = &quot;December&quot;, range = &quot;Q30:W36&quot;)
  )
}

#&#39; Create a calendar with all provided years
#&#39;
#&#39; @param year_list Relevant sheet names
#&#39;
#&#39; @returns A calendar with all years from indicated sheets
create_full_calendar = function(year_list) {
  output &lt;- tibble(
    day_of_week = NA,
    day = NA,
    month = NA,
    year = NA
  )
  
  for (i in 1:length(year_list)) {
    output &lt;- bind_rows(
      output,
      create_yearly_calendar(year_list[[i]])
    )
  }
  
  output &lt;- output %&gt;% drop_na(day)
}</code></pre>
<p>After having been read in, calendar data was merged with shooting
data and a variable was created to indicate whether or not the day of
week for each specific incident occured on the weekend or not.</p>
<pre class="r"><code>calendar &lt;- create_full_calendar(2006:2025) %&gt;% 
  mutate(
    day = as.numeric(day),
    year = as.numeric(year)
  )

# Merge with shootings:
calendar_shooting &lt;- left_join(shooting, calendar, by = c(&quot;month&quot;, &quot;day&quot;, &quot;year&quot;)) %&gt;% 
  mutate(
    weekend = case_when(
      day_of_week == &quot;Sunday&quot; ~ TRUE,
      day_of_week == &quot;Saturday&quot; ~ TRUE
    ),
    weekend = case_match(weekend,
      TRUE ~ &quot;Weekend&quot;,
      NA ~ &quot;Weekday&quot;
    ),
    day_of_week = as.factor(day_of_week),
    day_of_week = fct_relevel(day_of_week, c(&quot;Sunday&quot;, &quot;Monday&quot;, &quot;Tuesday&quot;, &quot;Wednesday&quot;, &quot;Thursday&quot;, &quot;Friday&quot;))
  )</code></pre>
</div>
<div id="weather-data" class="section level4">
<h4><em>Weather Data</em></h4>
<p>Weather data from the (NOAA)[<a
href="https://www.ncei.noaa.gov/metadata/geoportal/rest/metadata/item/gov.noaa.ncdc:C00861/html"
class="uri">https://www.ncei.noaa.gov/metadata/geoportal/rest/metadata/item/gov.noaa.ncdc:C00861/html</a>]
was used to measure the temperature for when shootings occurred. The
date variable was altered to match the date variable in the shooting
data, only temperature, precipitation, and location data was kept, and
the weather data was merged into the shooting data to provide that
weather data for each shooting incident.</p>
<pre class="r"><code>weather &lt;- weather %&gt;% 
  separate_wider_delim(date, delim = &quot;-&quot;, names_sep = &quot;_&quot;) %&gt;% 
  rename(
    year = date_1,
    month = date_2,
    day = date_3
  ) %&gt;% 
  mutate(
    month = case_match(month,
      &quot;01&quot; ~ &quot;January&quot;,
      &quot;02&quot; ~ &quot;February&quot;,
      &quot;03&quot; ~ &quot;March&quot;,
      &quot;04&quot; ~ &quot;April&quot;,
      &quot;05&quot; ~ &quot;May&quot;,
      &quot;06&quot; ~ &quot;June&quot;,
      &quot;07&quot; ~ &quot;July&quot;,
      &quot;08&quot; ~ &quot;August&quot;,
      &quot;09&quot; ~ &quot;September&quot;,
      &quot;10&quot; ~ &quot;October&quot;,
      &quot;11&quot; ~ &quot;November&quot;,
      &quot;12&quot; ~ &quot;December&quot;),
    day = as.numeric(day),
    year = as.numeric(year)) %&gt;% 
  filter(year &gt;= 2006) %&gt;% 
  select(name, month, day, year, prcp, prcp_attributes, tmax, tmin, latitude, longitude)

# Merging weather and shooting
weather_shooting &lt;- left_join(weather, shooting, by = c(&quot;month&quot;, &quot;day&quot;, &quot;year&quot;))</code></pre>
</div>
<div id="covid-19-pandemic-data" class="section level4">
<h4><em>COVID-19 Pandemic Data</em></h4>
<p>The COVID-19 Pandemic timeline is based on when WHO declared the
beginning (March 11, 2020) and end (May 5, 2023) of the pandemic. A
binary variable was created within the data to reflect whether or not an
incident occurred within the COVID-19 pandemic. In order to also measure
empty dates that had no shooting incident, the shooting data was first
merged into the weather data, and multiple incidents on single dates
were removed so that each date with an incident only had one incident.
This ensured that shooting rates within the pandemic and outside of the
pandemic could be compared.</p>
<pre class="r"><code>pandemic_shooting &lt;- left_join(weather, shooting, by = c(&quot;month&quot;, &quot;day&quot;, &quot;year&quot;)) %&gt;% 
  select(-c(name, prcp, prcp_attributes, tmax, tmin, latitude.x, longitude.x)) %&gt;% 
  group_by(year, month, day) %&gt;% 
  slice_head() %&gt;% 
  ungroup() %&gt;% 
  mutate(
    shooting = incident_key &gt; 0,
    shooting = case_match(shooting,
                          TRUE ~ &quot;Incident&quot;,
                          NA ~ &quot;No Incident&quot;),
    month = case_match(month,
                       &quot;January&quot; ~ 1,
                       &quot;February&quot; ~ 2,
                       &quot;March&quot; ~ 3,
                       &quot;April&quot; ~ 4,
                       &quot;May&quot; ~ 5,
                       &quot;June&quot; ~ 6,
                       &quot;July&quot; ~ 7,
                       &quot;August&quot; ~ 8,
                       &quot;September&quot; ~ 9,
                       &quot;October&quot; ~ 10,
                       &quot;November&quot; ~ 11,
                       &quot;December&quot; ~ 12),
    covid = case_when(
      year == 2020 &amp; month &gt; 3 ~ TRUE,
      year == 2020 &amp; month == 3 &amp; day &gt;= 11 ~ TRUE,
      year == 2021 ~ TRUE,
      year == 2022 ~ TRUE,
      year == 2023 &amp; month &lt; 5 ~ TRUE,
      year == 2023 &amp; month == 5 &amp; day &lt;= 5 ~ TRUE
    ),
    covid = case_match(covid,
                       TRUE ~ &quot;During Covid&quot;,
                       NA ~ &quot;Not During Covid&quot;),
    month = case_match(month,
                       1 ~ &quot;January&quot;,
                       2 ~ &quot;February&quot;,
                       3 ~ &quot;March&quot;,
                       4 ~ &quot;April&quot;,
                       5 ~ &quot;May&quot;,
                       6 ~ &quot;June&quot;,
                       7 ~ &quot;July&quot;,
                       8 ~ &quot;August&quot;,
                       9 ~ &quot;September&quot;,
                       10 ~ &quot;October&quot;,
                       11 ~ &quot;November&quot;,
                       12 ~ &quot;December&quot;)
    )</code></pre>
</div>
</div>
<div id="park-data" class="section level3">
<h3><strong>Park Data</strong></h3>
<p><code>parks_df</code> identifies property managed partially or solely
by <a
href="https://data.cityofnewyork.us/Recreation/Parks-Properties/enfh-gkve/about_data">NYC
Parks</a>. We dropped the <code>NAs</code> of parks without addresses,
as this is a key component of my green space analysis.</p>
<pre class="r"><code>parks_df =
  read_csv(&quot;Data Folder/Parks_Properties_Oct2025.csv&quot;, na = c(&quot;NA&quot;, &quot;.&quot;, &quot;&quot;)) |&gt; 
  janitor::clean_names() |&gt; 
  select(acquisitiondate, borough, zipcode, address, 
         eapply, location, acres, typecategory, retired) |&gt; 
  rename(boro = borough) |&gt; 
  drop_na(address) |&gt; 
   mutate(
      boro = case_when(
      boro == &quot;B&quot; ~ &quot;Brooklyn&quot;,
      boro == &quot;M&quot; ~ &quot;Manhattan&quot;,
      boro == &quot;Q&quot; ~ &quot;Queens&quot;,
      boro == &quot;R&quot; ~ &quot;Staten Island&quot;,
      boro == &quot;X&quot; ~ &quot;Bronx&quot;,
      TRUE ~ NA_character_
    ),
  address = paste(address, &quot;New York, NY&quot;, sep = &quot;, &quot;)
  ) |&gt;
  filter(boro == &quot;Manhattan&quot;) </code></pre>
</div>
<div id="manhattan-census-tract-data" class="section level3">
<h3><strong>Manhattan Census Tract Data</strong></h3>
<p>Census tract boundaries were obtained from the U.S. Census Bureau
using the TidyCensus R package. These tract boundaries allowed us to map
green space locations and street lamp locations to the correct census
tract while ensuring accurate spatial alignment with our shooting
incidents data.</p>
<pre class="r"><code>### Load Manhattan ACS population data

# Download Manhattan population data with geometry
manhattan_pop &lt;- get_acs(
  geography = &quot;tract&quot;,
  variables = &quot;B01003_001&quot;,
  state = &quot;NY&quot;,
  county = &quot;061&quot;, 
  geometry = TRUE,
  year = 2023
)

###  `county = &quot;061&quot;` indicates Manhattan
### `variables = &quot;B01003_001&quot;` indicates that we are requesting the total population estimate for each census tract from the ACS 5-year survey. This variable provides a count of all residents each census tract, which is useful for mapping population distribution and describing spatial relationships with parks and shooting incidents.</code></pre>
</div>
<div
id="if-anyone-else-used-any-other-data-add-your-sections-in-here-as-well"
class="section level3">
<h3>if anyone else used any other data, add your sections in here as
well</h3>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
